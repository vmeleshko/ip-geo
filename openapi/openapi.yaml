openapi: 3.1.0
info:
  title: IP Geolocation Service
  version: 0.1.0
  description: >
    OpenAPI specification for the IP geolocation microservice take-home test.
servers:
  - url: https://api.example.com
    description: Production (example)
  - url: http://localhost:8000
    description: Local development

paths:
  /health:
    get:
      summary: Health check
      operationId: healthCheck
      description: >
        Lightweight endpoint to verify that the service is running and able to
        serve requests. Returns a simple status payload.
      tags:
        - health
      responses:
        "200":
          description: Service is healthy.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                required:
                  - status

  /v1/ip/lookup:
    get:
      summary: Look up geolocation information for an IP address.
      operationId: ipLookup
      description: >
        Perform an IP geolocation lookup. If an explicit IP address is provided
        as a query parameter, that address is used. If it is omitted, the
        service will use the calling client's IP address as seen by the API.
      tags:
        - ip
      parameters:
        - name: ip
          in: query
          required: false
          description: >
            IPv4 or IPv6 address to look up. If not provided, the calling client's
            IP address is used instead.
          schema:
            type: string
          examples:
            explicitIpv4:
              summary: Explicit IPv4 lookup
              value: "8.8.8.8"
            explicitIpv6:
              summary: Explicit IPv6 lookup
              value: "2001:4860:4860::8888"
            clientIp:
              summary: Caller IP lookup
              value: null
      responses:
        "200":
          description: Geolocation information for the requested or calling IP.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IpGeolocationResponse"
        "400":
          description: Invalid or reserved IP address, or malformed request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalidIp:
                  summary: Invalid IP address
                  value:
                    code: "invalid_ip"
                    message: "The supplied IP address is not a valid IPv4 or IPv6 address."
                reservedIp:
                  summary: Reserved/private IP address
                  value:
                    code: "reserved_ip"
                    message: "The supplied IP address is reserved/private and cannot be geolocated."
        "404":
          description: No geolocation information found for this IP.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  summary: IP not found
                  value:
                    code: "ip_not_found"
                    message: "No geolocation information found for this IP address."
        "502":
          description: Upstream geolocation provider failed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                upstreamError:
                  summary: Upstream provider error
                  value:
                    code: "upstream_error"
                    message: "IP provider returned HTTP 500: Internal Server Error"

components:
  schemas:
    IPLookupRequest:
      type: object
      description: >
        Request body for IP geolocation lookup. If `ip` is provided, that IP is
        looked up. If it is omitted or null, the service uses the calling
        client's IP address.
      properties:
        ip:
          type: string
          nullable: true
          description: >
            IPv4 or IPv6 address to look up. If null or omitted, the calling
            client's IP is used instead.
          example: "8.8.8.8"

    IpGeolocationResponse:
      type: object
      description: Normalized geolocation information for an IP address.
      properties:
        ip:
          type: string
          description: IPv4 or IPv6 address that was resolved.
        country:
          type: string
          description: ISO 3166-1 alpha-2 country code.
          example: "DE"
        country_name:
          type: string
          example: "Germany"
        region:
          type: string
          example: "Berlin"
        city:
          type: string
          example: "Berlin"
        postal_code:
          type: string
          description: Postal or ZIP code for the location, if available.
          example: "10117"
        latitude:
          type: number
          format: float
          example: 52.5200
        longitude:
          type: number
          format: float
          example: 13.4050
        timezone:
          type: string
          example: "Europe/Berlin"
        isp:
          type: string
          example: "Example ISP GmbH"
      required:
        - ip
        - country
        - country_name
        - latitude
        - longitude

    ErrorResponse:
      type: object
      description: Standard error response.
      properties:
        code:
          type: string
          example: "invalid_ip"
        message:
          type: string
          example: "The supplied IP address is not a valid IPv4 or IPv6 address."
        details:
          type: array
          description: Optional structured error details (e.g. validation error list).
          items:
            type: object
            additionalProperties: true
      required:
        - code
        - message